{
  "name": "N-Coffee: –ù–æ–≤—ã–π –∑–∞–∫–∞–∑",
  "nodes": [
    {
      "parameters": {},
      "name": "Webhook",
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 1,
      "position": [250, 300],
      "webhookId": "new-order",
      "path": "new-order",
      "responseMode": "responseNode",
      "httpMethod": "POST"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict"
          },
          "conditions": [
            {
              "id": "condition-1",
              "leftValue": "={{ $json.body.event }}",
              "rightValue": "purchase",
              "operator": {
                "type": "string",
                "operation": "equals"
              }
            }
          ],
          "combinator": "and"
        }
      },
      "name": "Filter: Purchase",
      "type": "n8n-nodes-base.if",
      "typeVersion": 2,
      "position": [450, 300]
    },
    {
      "parameters": {
        "jsCode": "const data = $json.body.data;\nconst items = data.items || [];\n\nconst itemsList = items.map(i => `- ${i.title} x${i.count} = ${i.total}‚ÇΩ`).join('\\n');\n\nreturn [{\n  json: {\n    clientId: $json.body.clientId,\n    orderId: data.orderId,\n    total: data.total,\n    email: data.email,\n    phone: data.phone,\n    itemsList,\n    itemCount: items.length\n  }\n}];"
      },
      "name": "Prepare Data",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [650, 300]
    },
    {
      "parameters": {
        "sendOptions": {},
        "chatId": "={{ $env.TELEGRAM_CHAT_ID }}",
        "text": "=üéâ –ù–û–í–´–ô –ó–ê–ö–ê–ó!\\n\\nüìã –ó–∞–∫–∞–∑ #{{ $json.orderId }}\\nüí∞ –°—É–º–º–∞: {{ $json.total }}‚ÇΩ\\nüì¶ –¢–æ–≤–∞—Ä–æ–≤: {{ $json.itemCount }}\\n\\nüìß {{ $json.email || '–Ω–µ—Ç email' }}\\nüì± {{ $json.phone || '–Ω–µ—Ç —Ç–µ–ª–µ—Ñ–æ–Ω–∞' }}\\n\\n–¢–æ–≤–∞—Ä—ã:\\n{{ $json.itemsList }}",
        "additionalFields": {}
      },
      "name": "Telegram: New Order",
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.1,
      "position": [850, 200]
    },
    {
      "parameters": {
        "respondWith": "json",
        "responseBody": "={\"success\": true}"
      },
      "name": "Respond to Webhook",
      "type": "n8n-nodes-base.respondToWebhook",
      "typeVersion": 1,
      "position": [1050, 300]
    },
    {
      "parameters": {
        "to": "={{ $json.email }}",
        "subject": "=–í–∞—à –∑–∞–∫–∞–∑ #{{ $json.orderId }} –ø—Ä–∏–Ω—è—Ç ‚Äî N-Coffee",
        "text": "=–ó–¥—Ä–∞–≤—Å—Ç–≤—É–π—Ç–µ!\\n\\n–í–∞—à –∑–∞–∫–∞–∑ #{{ $json.orderId }} –Ω–∞ —Å—É–º–º—É {{ $json.total }}‚ÇΩ —É—Å–ø–µ—à–Ω–æ –æ—Ñ–æ—Ä–º–ª–µ–Ω.\\n\\n–ú—ã —Å–≤—è–∂–µ–º—Å—è —Å –≤–∞–º–∏ –¥–ª—è –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –¥–æ—Å—Ç–∞–≤–∫–∏.\\n\\n–°–ø–∞—Å–∏–±–æ –∑–∞ –ø–æ–∫—É–ø–∫—É!\\nN-Coffee",
        "options": {}
      },
      "name": "Email: Confirmation",
      "type": "n8n-nodes-base.emailSend",
      "typeVersion": 2.1,
      "position": [850, 400],
      "credentials": {
        "smtp": {
          "id": "YOUR_SMTP_CREDENTIAL_ID",
          "name": "SMTP Account"
        }
      }
    }
  ],
  "connections": {
    "Webhook": {
      "main": [
        [
          {
            "node": "Filter: Purchase",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Filter: Purchase": {
      "main": [
        [
          {
            "node": "Prepare Data",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Respond to Webhook",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Prepare Data": {
      "main": [
        [
          {
            "node": "Telegram: New Order",
            "type": "main",
            "index": 0
          },
          {
            "node": "Email: Confirmation",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Telegram: New Order": {
      "main": [
        [
          {
            "node": "Respond to Webhook",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Email: Confirmation": {
      "main": [
        [
          {
            "node": "Respond to Webhook",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "settings": {
    "executionOrder": "v1"
  },
  "staticData": null,
  "tags": []
}
